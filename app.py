from tkinter import Tk, Canvas
from typing import Any, Callable, List, Tuple

Point = Tuple[float | int, float | int]


def point_on_circle(center: Point, radius: float | int, angle: int | float):
    from math import cos, sin, radians
    angle = radians(angle - 90)
    x = center[0] + (radius * cos(angle))
    y = center[1] + (radius * sin(angle))

    return x, y

def draw_oval(
    coords: Tuple[Point, ...],
    fill: str | None = None,
    outline: str | None = None,
    width: float | None = None
):
    canvas_items.append(canvas.create_oval(
        coords,
        fill=fill or '',
        outline=outline or '#000',
        width=width or 0
    ))


def draw_rect(
    coords: Tuple[Point, ...],
    fill: str | None = None,
    outline: str | None = None,
    width: float | None = None
):
    canvas_items.append(canvas.create_rectangle(
        coords,
        fill=fill or '',
        outline=outline or '#000',
        width=width or 0
    ))


def draw_polygon(
    coords: Tuple[Point, ...],
    fill: str | None = None,
    outline: str | None = None,
    width: float | None = None
):
    outline = outline or ('#000' if width else '')
    canvas_items.append(canvas.create_polygon(
        coords,
        fill=fill or '',
        outline=outline,
        width=width or 0
    ))


def draw_path(
    coords: Tuple[Point, ...],
    outline: str | None = None,
    width: float | None = None
):
    for (i, point) in enumerate(coords):
        if i == 0:
            continue
        canvas_items.append(canvas.create_line(
            (coords[i - 1], point),
            fill=outline or '#000',
            width=width or ''
        ))


def repeat_draw(
    func: Callable,
    coords: Tuple[Tuple[Point, ...], ...],
    **kwargs
):
    for coord in coords:
        func(coord, **kwargs)


def is_number(x: Any):
    return type(x) == int or type(x) == float


def with_shift(
    shift: Point,
    coords: Tuple[Point | Tuple[Point, ...], ...]
) -> Tuple[Any]:
    def transform(x: Point | Tuple[Point, ...]):
        match x:
            case [int() | float(), int() | float()]:
                return x[0] + shift[0], x[1] + shift[1]
            case _:
                return with_shift(shift, x)

    return tuple(map(transform, coords))


class Drawer:
    timer = 0

    def draw_frame(self):
        self.timer += 1
        self.background()
        self.sun_layer()
        self.grass()
        self.bg_mountain_right()
        self.bg_mountain_left()
        self.clouds()
        self.river()
        self.fg_mountain_right_1()
        self.fg_mountain_right_2()
        self.fg_mountain_right_3()
        self.fg_mountain_left()
        self.fg_bg()
        self.trees()

    def background(self):
        draw_rect(((0, 0), (1284, 351)), fill='#3a5da5')

    def sun_layer(self):
        speed = 0.5
        sun_width = 185
        sun_height = 190

        angle = -75 + (self.timer * speed) % 160

        position = point_on_circle(
            center=(650, 500),
            radius=300,
            angle=angle
        )

        position = (position[0] - sun_width / 2, position[1] - sun_height / 2)
        self.sun(position)


    def sun(self, shift: Point = (0, 0)):
        draw_oval(with_shift(shift, ((0, 0), (184, 190))), fill='#efdcbe')
        draw_oval(with_shift(shift, ((14, 16), (167, 173))), fill='#fcfad9')
        draw_polygon(
            with_shift(
                shift,
                ((34, 76), (58, 75), (58, 75), (76, 80), (87, 75), (107, 73), (110, 64), (104, 62),
                 (92, 62), (85, 69), (65, 68), (55, 65), (40, 65), (32, 70), (34, 76))
            ),
            fill='#f5eccf'
        )
        draw_oval(with_shift(shift, ((46, 89), (66, 104))), fill='#fffcf0', outline='#d7c9c0', width=0.145)
        draw_oval(with_shift(shift, ((48, 95), (52, 98))), fill='#d5c6bd')
        draw_oval(with_shift(shift, ((79, 87), (98, 102))), fill='#fffcf0', outline='#d7c9c0', width=0.145)
        draw_oval(with_shift(shift, ((89, 92), (92, 96))), fill='#d5c6bd')
        draw_polygon(
            with_shift(
                shift,
                ((46, 143), (50, 127), (63, 112), (99, 110), (122, 124), (130, 138), (129, 152), (122, 160),
                 (108, 162), (93, 159), (76, 157), (60, 158), (51, 159), (47, 153), (46, 143))
            ),
            fill='#e45387'
        )
        draw_polygon(
            with_shift(
                shift,
                ((77, 137), (64, 139), (61, 143), (60, 150), (60, 158), (76, 157), (93, 159), (108, 162),
                 (111, 154), (113, 146), (108, 136), (89, 138), (84, 142), (77, 137))
            ),
            fill='#efa0a8'
        )
        draw_polygon(
            with_shift(
                shift,
                ((81, 111), (63, 112), (73, 119),
                 (90, 118), (99, 110), (81, 111))
            ),
            fill='#efa0a8'
        )
        repeat_draw(
            draw_rect,
            fill='#ffe0e6',
            coords=with_shift(
                shift,
                (((90, 149), (96, 156)),
                 ((77, 149), (83, 156)),
                 ((64, 149), (70, 156)),
                 ((101, 150), (107, 157)),
                 ((82, 114), (89, 121)),
                 ((73, 114), (79, 121)),
                 ((59, 142), (63, 148)),
                 ((63, 137), (66, 143)),
                 ((106, 142), (109, 149)),
                 ((103, 135), (107, 141)))
            )
        )

    def clouds(self):
        cloud_width = 124
        def move(x, speed): return ((x + self.timer * speed) % (width + cloud_width)) - cloud_width

        self.cloud((move(86, 2), 67))
        self.cloud((move(111, 1), 199))
        self.cloud((move(383, 1.5), 32))
        self.cloud((move(420, 2.5), 161))
        self.cloud((move(771, 2), 42))
        self.cloud((move(920, 1), 187))
        self.cloud((move(1035, 1.5), 80))

    def cloud(self, shift: Point = (0, 0)):
        repeat_draw(
            draw_oval,
            fill='#ffffff',
            coords=with_shift(
                shift,
                (((19, 8), (57, 45)),
                 ((66, 9), (103, 46)),
                 ((20, 35), (57, 71)),
                 ((46, 20), (84, 57)),
                 ((47, 38), (85, 75)),
                 ((71, 33), (109, 70)),
                 ((85, 19), (123, 56)),
                 ((41, 0), (78, 36)),
                 ((0, 31), (37, 68)))
            )
        )

    def grass(self):
        draw_rect(((-8, 341), (1347, 671)), fill='#aead6a', width=0.910954)

    def bg_mountain_right(self):
        draw_polygon(((618, 329), (694, 295), (714, 294), (714, 294), (780, 250), (874, 289), (874, 289),
                      (925, 290), (981, 304), (984, 346), (608, 349), (618, 329)), fill='#ab7ce3', width=1.0)
        repeat_draw(
            draw_path,
            width=1,
            coords=(
                ((780, 250), (772, 277), (816, 321), (816, 321), (826, 346)),
                ((772, 277), (743, 306), (730, 329), (702, 347)),
                ((780, 250), (755, 277), (718, 301), (714, 306), (689, 314), (652, 333)),
                ((730, 294), (718, 317), (688, 343)),
                ((823, 269), (844, 304), (882, 325), (882, 325), (914, 347)),
                ((778, 263), (817, 299), (838, 327), (870, 348)),
                ((855, 322), (876, 337), (880, 348)),
                ((836, 288), (891, 312), (891, 312), (924, 315), (968, 333)),
                ((817, 299), (839, 316), (855, 322), (855, 322)),
            )
        )

    def bg_mountain_left(self):
        draw_polygon(((322, 300), (368, 283), (368, 283), (412, 296), (426, 295), (478, 271), (478, 271), (500, 282),
                      (526, 279), (629, 325), (687, 338), (758, 351), (302, 354), (322, 300)), fill='#ac79e5', width=1.0)
        repeat_draw(
            draw_path,
            width=1,
            coords=(
                ((368, 283), (364, 295), (330, 315)),
                ((364, 295), (372, 323), (369, 347)),
                ((412, 296), (407, 309)),
                ((426, 295), (407, 309), (404, 320), (387, 328), (371, 339)),
                ((487, 276), (479, 286), (468, 286), (437, 317), (406, 342), (392, 350)),
                ((468, 286), (468, 286), (460, 285), (440, 296), (438, 305), (404, 320), (404, 320)),
                ((479, 286), (483, 292), (448, 325), (432, 338), (402, 350), (402, 350)),
                ((500, 282), (492, 296), (484, 316), (465, 332), (436, 348), (422, 353),
                 (466, 342), (508, 315), (508, 315), (530, 299), (539, 285)),
                ((500, 282), (510, 297), (510, 297), (530, 299)),
                ((510, 297), (494, 317), (474, 325)),
                ((494, 317), (488, 329)),
                ((500, 352), (542, 324), (547, 349), (547, 349), (553, 352)),
                ((542, 324), (530, 299)),
                ((467, 352), (493, 343), (518, 326), (530, 299)),
                ((629, 325), (645, 339), (645, 339), (670, 352)),
                ((645, 339), (687, 346), (707, 352), (707, 352)),
                ((691, 339), (718, 351)),
                ((593, 310), (610, 332), (610, 332), (630, 339), (649, 350)),
                ((610, 332), (609, 343), (622, 352)),
                ((567, 298), (569, 318), (597, 329), (609, 343), (609, 343)),
                ((569, 318), (564, 335), (547, 349)),
            )
        )

    def river(self):
        draw_polygon(
            ((417, 393), (454, 402), (572, 406), (625, 420), (706, 434), (842, 426), (975, 414), (1055, 402),
             (1050, 393), (718, 395), (650, 381), (520, 370), (404, 370), (408, 379), (417, 393)),
            fill='#8487e6',
            width=1
        )

    def fg_mountain_right_1(self):
        draw_polygon(((1025, 317), (1091, 256), (1091, 256), (1105, 254), (1178, 176), (1178, 176),
                      (1191, 171), (1297, 208), (1300, 311), (1025, 317)), fill='#945466', width=1.0)
        draw_polygon(((1178, 176), (1215, 198), (1243, 238), (1275, 272), (1299, 274),
                      (1297, 208), (1191, 171), (1178, 176)), fill='#746b40', width=1.0)
        repeat_draw(
            draw_path,
            width=1,
            coords=(
                ((1105, 254), (1098, 273), (1078, 310)),
                ((1098, 273), (1106, 306), (1106, 306)),
                ((1144, 215), (1124, 262), (1112, 288), (1106, 306), (1106, 306)),
                ((1154, 203), (1161, 232), (1161, 232), (1152, 250), (1133, 263), (1124, 285), (1123, 304)),
                ((1124, 285), (1106, 306), (1106, 306)),
                ((1215, 198), (1215, 301)),
                ((1204, 193), (1204, 253), (1215, 282)),
                ((1186, 182), (1183, 248), (1167, 265)),
                ((1169, 188), (1171, 243), (1171, 243), (1167, 265), (1153, 286), (1149, 303)),
                ((1178, 255), (1188, 283), (1204, 253)),
                ((1275, 272), (1278, 312)),
                ((1230, 221), (1232, 255)),
                ((1232, 255), (1250, 278), (1275, 272)),
                ((1227, 301), (1250, 278), (1278, 312)),
            )
        )

    def fg_mountain_right_2(self):
        draw_polygon(((762, 389), (848, 350), (848, 350), (912, 338), (912, 338), (922, 320), (959, 304), (971, 239),
                      (1003, 240), (1036, 283), (1051, 286), (1060, 301), (1060, 393), (762, 389)), fill='#a04873', width=1.0)
        draw_polygon(((976, 239), (982, 244), (998, 245), (1025, 291), (1025, 291), (1038, 300), (1040, 308),
                      (1065, 307), (1051, 286), (1051, 286), (1036, 283), (1003, 240), (976, 239)), fill='#80833e', width=1.0)
        repeat_draw(
            draw_path,
            width=1,
            coords=(
                ((982, 244), (986, 270), (993, 336), (1007, 392)),
                ((987, 272), (985, 355), (985, 355), (966, 392)),
                ((959, 304), (962, 334), (952, 390)),
                ((819, 389), (854, 375), (879, 345), (924, 349)),
                ((912, 338), (924, 349), (930, 390)),
                ((922, 320), (932, 336), (932, 336), (924, 349)),
                ((932, 336), (962, 334), (962, 334)),
                ((987, 272), (1009, 334), (1025, 291)),
            )
        )

    def fg_mountain_right_3(self):
        draw_polygon(((995, 415), (1034, 340), (1034, 307), (1227, 301), (1227, 301),
                      (1287, 314), (1291, 422), (995, 415)), fill='#6a4243', width=1.0)
        repeat_draw(
            draw_path,
            width=1,
            coords=(
                ((1034, 307), (1049, 320), (1049, 336), (1031, 388), (995, 415), (995, 415)),
                ((1077, 318), (1065, 350), (1060, 393), (1060, 393), (1052, 417)),
                ((1049, 336), (1061, 312)),
                ((1102, 315), (1102, 344), (1088, 372), (1081, 397), (1081, 397), (1075, 417)),
                ((1118, 315), (1118, 341), (1118, 341), (1113, 361), (1110, 379)),
                ((1133, 312), (1128, 335), (1133, 355), (1130, 378), (1125, 403)),
                ((1148, 312), (1148, 354), (1130, 378), (1130, 378)),
                ((1180, 311), (1175, 351), (1161, 370), (1157, 395)),
                ((1175, 351), (1171, 396)),
                ((1225, 336), (1225, 316), (1225, 316)),
                ((1212, 335), (1200, 357), (1193, 379), (1193, 379), (1187, 411)),
                ((1240, 341), (1228, 369), (1228, 369), (1203, 381), (1189, 395)),
                ((1262, 343), (1254, 375), (1236, 393), (1229, 420), (1229, 420)),
            )
        )
        draw_polygon(((1301, 319), (1227, 301), (1295, 282), (1301, 319)), fill='#756b48', width=1.0)
        draw_polygon(((1034, 307), (1085, 317), (1085, 317), (1133, 312), (1186, 312), (1193, 332),
                      (1282, 349), (1287, 314), (1227, 301), (1034, 307)), fill='#7b6035', width=1.0)
        draw_polygon(((1186, 312), (1222, 310), (1227, 301), (1034, 307), (1085, 317),
                      (1133, 312), (1186, 312)), fill='#847e45', width=1.0)

    def fg_mountain_left(self):
        draw_polygon(((589, 422), (485, 394), (417, 393), (421, 434), (589, 422)), fill='#844c5f', width=1.0)
        draw_polygon(((556, 459), (418, 374), (265, 239), (207, 273), (86, 208), (-9, 125),
                      (-20, 520), (239, 504), (385, 459), (556, 459)), fill='#8b4662', width=1.0)
        draw_polygon(((-28, 369), (49, 411), (163, 395), (65, 381), (27, 384),
                      (27, 384), (-28, 369)), fill='#4c3f35', width=1.0)
        repeat_draw(
            draw_path,
            width=1,
            coords=(
                ((163, 395), (187, 442), (211, 473), (96, 507), (96, 507), (-38, 476), (-28, 369)),
                ((265, 239), (280, 287), (322, 330), (351, 403), (368, 467)),
                ((387, 351), (400, 378), (400, 378), (425, 459)),
                ((400, 378), (518, 458)),
                ((322, 330), (363, 350), (400, 378), (400, 378)),
                ((280, 287), (262, 318), (298, 370), (328, 430), (368, 467), (368, 467)),
                ((328, 430), (318, 471), (320, 478)),
                ((262, 318), (207, 273)),
                ((-7, 141), (67, 213), (118, 247), (118, 247), (191, 273), (191, 273), (207, 273), (207, 273)),
                ((182, 270), (204, 305), (253, 352), (303, 380)),
                ((118, 247), (128, 278), (170, 326), (229, 371), (287, 412), (328, 430), (328, 430)),
                ((118, 247), (110, 263), (112, 310), (161, 364), (228, 411), (270, 458), (286, 490)),
                ((183, 431), (210, 400)),
                ((-11, 190), (55, 256), (55, 256), (100, 318), (129, 367), (144, 392)),
                ((77, 325), (128, 366)),
                ((21, 271), (49, 344), (83, 384)),
                ((49, 344), (40, 383)),
                ((-8, 165), (71, 241), (86, 278), (91, 305)),
                ((21, 271), (-6, 247)),
                ((77, 325), (54, 282), (24, 239), (16, 220)),
                ((128, 278), (186, 302), (204, 305), (204, 305)),
                ((49, 411), (84, 469), (96, 507)),
                ((49, 411), (39, 458), (49, 498)),
                ((-6, 382), (-7, 432), (16, 489)),
                ((49, 411), (110, 440), (159, 483), (200, 503)),
                ((136, 399), (157, 445), (159, 483)),
                ((477, 430), (479, 460)),
                ((476, 409), (500, 405), (524, 418), (552, 420), (552, 420), (589, 422), (589, 422)),
            )
        )

    def fg_bg(self):
        draw_oval(((-43, 512), (743, 741)), fill='#72664a', width=1.97556)
        draw_oval(((531, 542), (1017, 697)), fill='#72664a', width=1.27955)
        draw_oval(((672, 542), (1322, 697)), fill='#7d6d4e', width=1.47696)
        draw_oval(((-28, 587), (1338, 803)), fill='#3c392c', width=2.41824)

    def trees(self):
        self.tree((264, 361))
        self.tree((65, 411))
        self.tree((838, 390))
        self.tree((1017, 423))

    def tree(self, shift: Point = (0, 0)):
        draw_polygon(
            with_shift(
                shift,
                ((136, 291), (118, 292), (120, 203), (120, 203), (122, 188), (122, 188), (111, 173),
                 (82, 158), (63, 161), (55, 149), (65, 156), (77, 154), (72, 137), (86, 152), (117, 165),
                 (99, 119), (104, 106), (124, 159), (124, 159), (151, 125), (155, 132), (129, 166), (130, 197),
                 (151, 174), (163, 139), (161, 177), (138, 209), (136, 291)),
            ),
            fill='#625447'
        )
        repeat_draw(
            draw_oval,
            fill='#5f663e',
            coords=with_shift(
                shift,
                (((169, 12), (248, 55)),
                 ((17, 108), (83, 160)),
                 ((0, 0), (220, 126)),
                 ((110, 77), (251, 152)))
            )
        )
        repeat_draw(
            draw_oval,
            fill='#b4723d',
            coords=with_shift(
                shift,
                (((29, 61), (48, 85)),
                 ((57, 82), (89, 103)),
                 ((93, 5), (110, 13)),
                 ((84, 103), (104, 115)),
                 ((93, 92), (104, 98)),
                 ((34, 45), (48, 55)),
                 ((197, 89), (225, 107)),
                 ((129, 108), (143, 122)),
                 ((153, 102), (158, 108)),
                 ((152, 117), (158, 123)),
                 ((167, 132), (172, 137)),
                 ((200, 118), (213, 127)),
                 ((217, 107), (224, 118)),
                 ((227, 104), (236, 111)),
                 ((51, 143), (62, 152)),
                 ((22, 125), (27, 134)),
                 ((223, 34), (234, 43)),
                 ((229, 25), (237, 32)),
                 ((239, 30), (241, 37)))
            )
        )


def animation():
    # Optimization
    canvas.delete(*canvas_items)
    canvas_items.clear()

    drawer.draw_frame()

    window.after(frame_time, animation)


def init_window():
    window = Tk(baseName='Screaming Sunrise', className='screaming sunrise')
    window.title('Screaming Sunrise')
    return window


def init_canvas(window: Tk):
    canvas = Canvas(window, bg='white', height=height, width=width)
    canvas.pack()
    return canvas


# 30 FPS
frame_time = 33
height = 720
width = 1280

canvas_items: List[int] = []

window = init_window()
canvas = init_canvas(window)
drawer = Drawer()
animation()
window.mainloop()
